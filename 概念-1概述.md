## 概述

Kubernetes 是一个可移植、可扩展的开源平台，用于管理容器化的工作负载和服务，可促进声明式配置和自动化。

### 主要功能

- 服务发现和负载均衡：DNS或IP实现服务发现，负载均衡分配网络流量
- 存储编排：自动挂载选择的存储系统，包括本次存储，公共云。
- 自动部署和回滚：自动化容器创建、状态控制
- 自动完成装箱计算：允许指定每个容器所需 CPU 和内存
- 自我修复：重启失败的容器、替换容器、杀死不响应的容器
- 秘钥与配置管理：允许存储和管理敏感信息，例如密码、OAuth 令牌和 ssh 密钥

### 组件

- 控制平面组件（Control Plane Components）：控制平面的组件对集群做出全局决策（比如调度），以及检测和响应集群事件
  - kube-apiserver： 该组件公开了 Kubernetes API，是 Kubernetes 控制面的前端。它可通过部署多个实例进行伸缩。
  - etcd：兼具一致性和高可用性的键值数据库，可以作为保存 Kubernetes 所有集群数据的后台数据库。
  - kube-scheduler：负责监视新创建的、未指定运行节点（node）的 Pods，选择节点让 Pod 在上面运行。
  - kube-controller-manager：运行控制器进程的控制平面组件。包括：
    - 节点控制器（Node Controller）：负责在节点出现故障时进行通知和响应
    - 任务控制器（Job controller）：监测代表一次性任务的 Job 对象，然后创建 Pods 来运行这些任务直至完成
    - 端点控制器（Endpoints Controller）：填充端点（Endpoints）对象（即加入 Service 与 Pod）
    - 服务帐户和令牌控制器（Service Account & Token Controllers）：为新的命名空间创建默认帐户和 API 访问令牌
  - cloud-controller-manager：云控制器管理器，集群连接到云提供商的 API 之上。包括：
    - 节点控制器（Node Controller）：用于在节点终止响应后检查云提供商以确定节点是否已被删除
    - 路由控制器（Route Controller）：用于在底层云基础架构中设置路由
    - 服务控制器（Service Controller）：用于创建、更新和删除云提供商负载均衡器
- Node 组件：维护运行的 Pod 并提供 Kubernetes 运行环境
  - kubelet：集群中每个节点（node）上运行的代理。 它保证容器（containers）都 运行在 Pod 中。
  - kube-proxy：集群中每个节点上运行的网络代理，允许从集群内部或外部的网络会话与 Pod 进行网络通信。
  - 容器运行时（Container Runtime）：负责运行容器的软件，例如 Docker、 containerd、CRI-O 以及 Kubernetes CRI (容器运行环境接口) 的其他任何实现。
- 插件（Addons）
  - DNS ：必备插件， 为 Kubernetes 服务提供 DNS 记录。
  - Web 界面（仪表盘）：管理集群中运行的应用程序以及集群本身并进行故障排除
  - 容器资源监控：负责将集群资源状态、节点状态等保存到集中的数据库中，并提供浏览界面。
  - 集群层面日志：负责将容器的日志数据 保存到一个集中的日志存储中，该存储能够提供搜索和浏览接口。

### Kubernetes API

Kubernetes 控制面的核心是 API 服务器。 API 服务器负责提供 HTTP API，以供用户、集群中的不同部分和集群外部组件相互通信。

大部分操作都可以通过 kubectl 命令行接口或 类似 kubeadm 这类命令行工具来执行， 这些工具在背后也是调用 Rest API。

- 各个语言 API 类库： [客户端库](https://kubernetes.io/zh/docs/reference/using-api/client-libraries/)
- Open API 规范： [OpenAPI](https://www.openapis.org/)

### 使用 Kubernetest 对象