## 工作负载

工作负载（ workload）是在 Kubernetes 上运行的应用程序。

Kubernetes 提供若干种内置的工作负载资源：

- Deployment 和 ReplicaSet （替换原来的资源 ReplicationController，ReplicaSet 就是 Deployment 的一个子集。Deployment 控制器实际操纵的是 ReplicaSet 对象，而不是 Pod 对象。）。 Deployment 很适合用来管理集群上的无状态应用，Deployment 中的所有 Pod 都是相互等价的，并且在需要的时候被换掉。
- StatefulSet 运行一个或者多个以某种方式跟踪应用状态的 Pods。 
- DaemonSet 在节点上创建一个 pod 副本。通常用于系统监控相关的 pod，如日志采集。
- Job 和 CronJob。 定义一些一直运行到结束并停止的任务。Job 用来表达的是一次性的任务，而 CronJob 会根据其时间规划反复运行。

### Pods

*Pod* 是可以在 Kubernetes 中创建和管理的、最小的可部署的计算单元。

Pod 通常不是直接创建的，而是使用工作负载资源创建的

#### Pod 的生命周期

| 取值                | 描述                                                         |
| :------------------ | :----------------------------------------------------------- |
| `Pending`（悬决）   | Pod 已被 Kubernetes 系统接受，但有一个或者多个容器尚未创建亦未运行。此阶段包括等待 Pod 被调度的时间和通过网络下载镜像的时间。 |
| `Running`（运行中） | Pod 已经绑定到了某个节点，Pod 中所有的容器都已被创建。至少有一个容器仍在运行，或者正处于启动或重启状态。 |
| `Succeeded`（成功） | Pod 中的所有容器都已成功终止，并且不会再重启。               |
| `Failed`（失败）    | Pod 中的所有容器都已终止，并且至少有一个容器是因为失败终止。也就是说，容器以非 0 状态退出或者被系统终止。 |
| `Unknown`（未知）   | 因为某些原因无法取得 Pod 的状态。这种情况通常是因为与 Pod 所在主机通信失败。 |

##### 容器状态

- Waiting （等待）
   处于 Waiting 状态的容器仍在运行它完成启动所需要的操作

- Running（运行中）
  Running 状态表明容器正在执行状态并且没有问题发生。 

- Terminated（已终止） 
  处于 Terminated 状态的容器已经开始执行并且或者正常结束或者因为某些原因失败。 

##### 容器重启策略

Pod 的 `spec` 中包含一个 `restartPolicy` 字段，其可能取值包括 Always、OnFailure 和 Never。默认值是 Always。

##### 容器探针

- **exec**：在容器内执行指定命令。如果命令退出时返回码为 0 则认为诊断成功。
- **grpc**：使用 gRPC 执行一个远程过程调用。 如果响应的状态是 "SERVING"，则认为诊断成功
- **httpGet**：对容器的 IP 地址上指定端口和路径执行 HTTP `GET` 请求
- **tcpSocket**：对容器的 IP 地址上的指定端口执行 TCP 检查。如果端口打开，则诊断被认为是成功的

#### Init 容器

每个 Pod 中可以包含多个容器， 应用运行在这些容器里面，同时 Pod 也可以有一个或多个先于应用容器启动的 Init 容器。

如果 Pod 的 Init 容器失败，kubelet 会不断地重启该 Init 容器直到该容器成功为止。 如果 Pod 对应的 restartPolicy 值为 "Never"，并且 Pod 的 Init 容器失败， 则 Kubernetes 会将整个 Pod 状态设置为失败。

为 Pod 设置 Init 容器需要在 Pod 规约 中添加 initContainers 字段， 该字段以 Container 类型对象数组的形式组织